const leftSidebarButton=document.querySelector(".left-sidebar__button"),leftSidebarMenu=document.querySelector(".left-sidebar__menu");leftSidebarButton.addEventListener("click",(function(){leftSidebarMenu.classList.toggle("leftSidebarMenu")}));const blockElements=[{type:"block",width:"100%",height:"80px",bgColor:"#c6c3af77"},{type:"block",width:"100%",height:"80px",bgColor:"#fff973"},{type:"block",width:"100%",height:"300px",bgColor:"pink"},{type:"block",width:"100%",height:"500px",bgColor:"#c6c3af77"},{type:"block",width:"100%",height:"100px",bgColor:"#fff973"},{type:"block",width:"100%",height:"100px",bgColor:"pink"}],buttonElements=[{type:"button",width:"150px",height:"30px",bgColor:"#fff973",color:"black",text:"Кнопка"},{type:"button",width:"150px",height:"30px",bgColor:"#c6c3af",color:"black",text:"Кнопка"}],textElements=[{type:"text",textStyle:"header_h2",width:"150px",height:"30px",fontSize:"32px",color:"#000",text:"Заголовок"},{type:"text",textStyle:"simple_text",width:"150px",height:"30px",fontSize:"14px",color:"#000",text:"Ваш текст будет написан в этом блоке"}],imageElements=[{type:"image",width:"150px",height:"150px",border:"1px solid #c6c3af",bgImage:"url(./img/bar-chart.png)"},{type:"image",width:"150px",height:"150px",border:"1px solid #c6c3af",bgImage:"url(./img/team-work.png)"}],iconElements=[{type:"icon",width:"24px",height:"24px",border:"1px solid #c6c3af",icon:"url(./img/social/facebook.svg)",link:"https://www.facebook.com"}];let categories=document.querySelectorAll(".categories__button");for(let e=0;e<categories.length;e++)categories[e].onclick=function(e){let t=e.target;if(t.classList.contains("left-sidebar__categories-block")){let e=blockElements,t="";for(let n of e)t+=`<div class="element" tabindex="0" data-type="${n.type}" style="background: ${n.bgColor}; width: ${n.width}; height: ${n.height};" draggable="true"> </div>`;document.querySelector(".left-sidebar__elements").innerHTML=t}else if(t.classList.contains("left-sidebar__categories-button")){let e=buttonElements,t="";for(let n of e)t+=`<div class="element" tabindex="0" data-type="${n.type}" style="color: ${n.color}; background-color: ${n.bgColor}; width: ${n.width}; height: ${n.height};" draggable="true">${n.text}</div>`;document.querySelector(".left-sidebar__elements").innerHTML=t}else if(t.classList.contains("left-sidebar__categories-text")){let e=textElements,t="";for(let n of e)t+=`<div class="element" tabindex="0" data-type="${n.type}" data-textstyle="${n.textStyle}" style="color: ${n.color}; width: ${n.width}; height: ${n.height}; font-size: ${n.fontSize}" draggable="true">${n.text}</div>`;document.querySelector(".left-sidebar__elements").innerHTML=t}else if(t.classList.contains("left-sidebar__categories-image")){let e=imageElements,t="";for(let n of e)t+=`<div class="element" tabindex="0" data-type="${n.type}" style="width: ${n.width}; border: ${n.border}; background-image: ${n.bgImage}; height: ${n.height};" draggable="true"> </div>`;document.querySelector(".left-sidebar__elements").innerHTML=t}else if(t.classList.contains("left-sidebar__categories-icon")){let e=iconElements,t="";for(let n of e)t+=`<div class="element" tabindex="0" data-type="${n.type}" style="width: ${n.width}; border: ${n.border}; icon: ${n.icon}; height: ${n.height};" draggable="true"> </div>`;document.querySelector(".left-sidebar__elements").innerHTML=t}dragAndDrop()};document.addEventListener("DOMContentLoaded",(function(e){let t=localStorage.getItem("login"),n=localStorage.getItem("firstname");null!=t&&(document.getElementById("wrapper__button").innerHTML=`<div>Привет, ${n}!</div><button id="buttonOut" onclick="outUser()" class="regButton">Выйти</button>`)}));let errors=[];function showReg(e){errors=[],document.getElementById("windowReg").style.display=e,document.getElementById("gray").style.display=e}function showIn(e){document.getElementById("windowIn").style.display=e,document.getElementById("gray2").style.display=e;let t=localStorage.getItem("email"),n=localStorage.getItem("pass");null!=t&&(document.querySelector("#email__in").value=t),null!=t&&(document.querySelector("#pass__in").value=n)}function checkValidity(e){let t=e.validity;return console.log(t.valueMissing),t.valueMissing&&errors.push("Поле "+e.placeholder+" не заполнено"),t.patternMismatch&&errors.push("Не верный формат заполнения e-mail"),errors}function checkPassword(){let e=document.querySelector("#pass1").value,t=document.querySelector("#pass2").value;return console.log(e),null!=e&&(e.length<4&&errors.push("Минимальное значение пароля не может быть меньше, чем 4"),e.length>10&&errors.push("Максимальное значение пароля не может быть больше, чем 10"),-1===e.search(/[a-z]/)&&errors.push("Пароль должен содержать минимум одну прописную букву"),-1===e.search(/[A-Z]/)&&errors.push("Пароль должен содержать минимум одну заглавную букву"),-1===e.search(/[0123456789]/)&&errors.push("Пароль должен содержать минимум одну цифру"),e!=t&&errors.push("Пароль не совпадает!")),errors}function pushReg(){let e=document.querySelectorAll(".inputReg");console.log(e);for(let t of e)checkValidity(t);checkPassword(),0==errors?saveData():(document.getElementById("error").innerHTML=errors.join(".<br>"),errors=[]),document.querySelector("form").addEventListener("submit",(e=>e.preventDefault()))}function saveData(){let e=document.querySelector("#firstname").value,t=document.querySelector("#lastname").value,n=document.querySelector("#email").value,l=document.querySelector("#pass1").value,o=document.querySelector("#pass2").value;console.log(l,o),document.querySelector(".error").innerHTML="",null==localStorage.getItem("firstName")&&localStorage.setItem("firstname",e),null==localStorage.getItem("lastname")&&localStorage.setItem("lastname",t),null==localStorage.getItem("email")&&localStorage.setItem("email",n),null==localStorage.getItem("pass")&&localStorage.setItem("pass",o),localStorage.setItem("login",!0),document.getElementById("windowReg").style.display="none",document.getElementById("gray").style.display="none",document.querySelector("form").addEventListener("submit",(e=>e.preventDefault())),document.getElementById("wrapper__button").innerHTML=`<div>Привет, ${e}!</div><button id="buttonOut" onclick="outUser()" class="regButton">Выйти</button>`}function getIn(){document.querySelector("#inForm").addEventListener("submit",(e=>e.preventDefault())),document.getElementById("windowIn").style.display="none",document.getElementById("gray2").style.display="none",document.getElementById("wrapper__button").innerHTML=`<div>Привет, ${localStorage.getItem("firstname")}!</div><button id="buttonOut" onclick="outUser()" class="regButton">Выйти</button>`,localStorage.setItem("login",!0)}function outUser(){document.getElementById("wrapper__button").innerHTML='<button id="buttonReg" onclick="showReg(\'block\')" class="regButton">Регистрация</button>\n    <button id="buttonIn" onclick="showIn(\'block\')" class="regButton">Войти</button>',localStorage.removeItem("login")}let templateIndCount=0;const menuBlock=document.querySelector(".left-sidebar__elements"),templateBlock=document.querySelector(".template");function handleDocLoad(){console.log("load");const e=userLoggedIn();if(console.log(e),isUserTemplateInLS(e)){renderPopup(JSON.parse(localStorage.getItem(e)),"open")}}function userLoggedIn(){const e=localStorage.getItem("email");return!(!e||"true"!==localStorage.getItem("login"))&&e}function isUserTemplateInLS(e){return null!==localStorage.getItem(e)}function renderPopup(e,t){const n=document.querySelector("#windowSelectTemplate > .popup__form");if(n.innerHTML="",e.forEach(((l,o)=>{let a=document.createElement("button");a.textContent=l.name,a.classList.add("btnForm"),a.dataset.id=o,n.append(a),a.addEventListener("click",{handleEvent:selectTemplate,arr:e,action:t})})),"open"===t){let e=document.createElement("h2");e.innerHTML="Выберите проект",n.prepend(e),addEmptyTemplateBtn(n)}else if("save"===t){let e=document.createElement("h2");e.innerHTML="Сохранить под именем:",n.prepend(e),console.log("save"),addNewTemplateInput(n)}showPopup("block")}function addEmptyTemplateBtn(e){const t=document.createElement("button");t.textContent="Создать новый проект",t.classList.add("btnForm"),e.append(t),t.addEventListener("click",openEmptyProject)}function addNewTemplateInput(e){let t=document.createElement("h2");t.innerHTML="Новый проект:",e.append(t);const n=document.createElement("input");n.id="projectname",n.placeholder="Название проекта",n.type="text",n.classList.add("inputReg"),e.append(n);const l=document.createElement("button");l.textContent="Сохранить",l.classList.add("btnForm"),e.append(l),l.addEventListener("click",saveNewTemplate)}function saveNewTemplate(e){const t=userLoggedIn(),n=document.querySelector("#projectname").value;console.log(n);const l={name:n,html:templateBlock.innerHTML};if(isUserTemplateInLS(t)){let e=[],n=null;n=JSON.parse(localStorage.getItem(t)),n.length>1?e.push(...n,l):e.push(n,l),localStorage.setItem(t,JSON.stringify(e))}else localStorage.setItem(t,JSON.stringify(l));showPopup("none")}function openEmptyProject(){showPopup("none")}function showPopup(e){document.getElementById("windowSelectTemplate").style.display=e,document.getElementById("grayBackground").style.display=e}function handleTemplateLoad(){getTemplateElements().forEach((e=>{addListenersForNewElement(e)}))}function getTemplateElements(){return document.querySelectorAll(".template__element")}function selectTemplate(e){"open"===this.action?(renderHtmlById(e.target.dataset.id,this.arr),handleTemplateLoad()):this.action,showPopup("none")}function renderHtmlById(e,t){html=t[e].html,templateBlock.innerHTML=html}function handleSaveClick(e){const t=userLoggedIn();if(isUserTemplateInLS(t)){renderPopup(JSON.parse(localStorage.getItem(t)),"save")}else showIn("block")}templateBlock.addEventListener("dragover",dragOver),templateBlock.addEventListener("dragenter",dragEnter),templateBlock.addEventListener("dragleave",dragLeave),templateBlock.addEventListener("drop",dragDrop,{capture:!0}),document.querySelector(".save img").addEventListener("click",handleSaveClick),handleDocLoad();let templateFlag=!1,movingElement=null,elementX=0,elementY=0;function dragAndDrop(){document.querySelectorAll(".element").forEach((e=>{e.addEventListener("dragstart",dragStart),e.addEventListener("dragend",dragEnd)}))}function dragStart(e){getPosition(e),getTemplateFlag(e),setTimeout((()=>{e.target.parentNode.isSameNode(menuBlock)?movingElement=e.target.cloneNode(!0):e.target.parentNode.isSameNode(templateBlock)&&(movingElement=e.target)}))}function dragEnd(e){e.preventDefault()}function dragOver(e){e.preventDefault()}function dragEnter(e){e.preventDefault()}function dragLeave(e){e.preventDefault()}function dragDrop(e){e.stopPropagation(),e.preventDefault(),e.target.isSameNode(movingElement)||(this.append(movingElement),movingElement.classList.remove("element"),movingElement.classList.add("template__element"),addListenersForNewElement(movingElement),templateFlag?setPosition(e):createNewElement(e,movingElement))}function createNewElement(e,t){const n=t.dataset.type;if("block"===n)t.classList.add("wide");else switch(t.classList.add("draggable-element"),setPosition(e),n){case"button":t.classList.add("template__button");break;case"icon":break;case"text":t.style.width="";const e=t.dataset.textstyle;t.classList.add(e),t.classList.add("template__text");break;case"image":t.classList.add("template__image")}}function addListenersForNewElement(e){e.addEventListener("click",handleClick),e.addEventListener("dblclick",handleDoubleClick),e.addEventListener("focusout",handleFocusOut),e.addEventListener("dragstart",dragStart)}function pasteCopiedElement(e){templateBlock.append(e),e.style.top=e.style.top.slice(0,-2)- -50+"px",e.style.left=e.style.left.slice(0,-2)- -50+"px",e.classList.remove("selected"),addListenersForNewElement(e)}function getTemplateFlag(e){templateFlag=!!e.target.parentNode.isSameNode(templateBlock)}function setPosition(e){offParTop=e.target.offsetParent.offsetTop,offParLeft=e.target.offsetParent.offsetLeft,movingElement.style.top=e.clientY-elementY-offParTop+"px",movingElement.style.left=e.clientX-elementX-offParLeft+"px"}function getPosition(e){elementY=e.offsetY,elementX=e.offsetX}function handleClick(e){e.target.classList.add("selected"),e.target.focus(),e.target.addEventListener("keydown",handleKeyDown)}function handleDoubleClick(e){e.target.contentEditable=!0,e.target.removeEventListener("click",handleClick),e.target.removeEventListener("keydown",handleKeyDown),e.target.classList.add("selected"),"text"===e.target.dataset.type&&(e.target.style.height="auto")}function handleFocusOut(e){window.getSelection().removeAllRanges(),e.target.contentEditable=!1,e.target.classList.remove("selected"),e.target.addEventListener("click",handleClick)}function handleKeyDown(e){if(e.preventDefault(),!0===e.ctrlKey&&"c"===e.key)movingElement=e.target.cloneNode(!0);else if(!0===e.ctrlKey&&"v"===e.key)pasteCopiedElement(movingElement);else if("Delete"===e.key)e.target.remove();else if("ArrowLeft"===e.key){let t=e.target.style.left;e.target.style.left=t.slice(0,t.length-2)-1+"px"}else if("ArrowRight"===e.key){let t=e.target.style.left;e.target.style.left=t.slice(0,t.length-2)- -1+"px"}else if("ArrowUp"===e.key){let t=e.target.style.top;e.target.style.top=t.slice(0,t.length-2)-1+"px"}else if("ArrowDown"===e.key){let t=e.target.style.top;e.target.style.top=t.slice(0,t.length-2)- -1+"px"}}