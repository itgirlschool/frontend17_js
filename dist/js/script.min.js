const leftSidebarButton=document.querySelector(".left-sidebar__button"),leftSidebarMenu=document.querySelector(".left-sidebar__menu");leftSidebarButton.addEventListener("click",(function(){leftSidebarMenu.classList.toggle("leftSidebarMenu")}));const blockElements=[{type:"block",width:"100%",height:"80px",bgColor:"#c6c3af"},{type:"block",width:"100%",height:"80px",bgColor:"#fff973"},{type:"block",width:"100%",height:"300px",bgColor:"pink"},{type:"block",width:"100%",height:"500px",bgColor:"#c6c3af"},{type:"block",width:"100%",height:"100px",bgColor:"#fff973"},{type:"block",width:"100%",height:"100px",bgColor:"pink"}],buttonElements=[{type:"button",width:"150px",height:"30px",bgColor:"#fff973",color:"black",text:"Кнопка"},{type:"button",width:"150px",height:"30px",bgColor:"#c6c3af",color:"black",text:"Кнопка"}],textElements=[{type:"text",textStyle:"header_h2",width:"150px",height:"30px",fontSize:"32px",color:"#000",text:"Заголовок 2"},{type:"text",textStyle:"simple_text",width:"150px",height:"30px",fontSize:"14px",color:"#000",text:"Ваш текст будет написан в этом блоке"}],imageElements=[{type:"image",width:"150px",height:"150px",border:"1px solid #c6c3af",bgImage:'url("./img/work-together.jpg")'}],iconElements=[{type:"icon",width:"24px",height:"24px",border:"1px solid #c6c3af",icon:"url(./img/social/facebook.svg)",link:"https://www.facebook.com"}];let categories=document.querySelectorAll(".categories__button");for(let e=0;e<categories.length;e++)categories[e].onclick=function(e){let t=e.target;if(t.classList.contains("left-sidebar__categories-block")){let e=blockElements,t="";for(let o of e)t+=`<div class="element"  tabindex="0" data-type="${o.type}" style="background: ${o.bgColor}; width: ${o.width}; height: ${o.height};" draggable="true"> </div>`;document.querySelector(".left-sidebar__elements").innerHTML=t}else if(t.classList.contains("left-sidebar__categories-button")){let e=buttonElements,t="";for(let o of e)t+=`<div class="element" tabindex="0" data-type="${o.type}" style="color: ${o.color}; background-color: ${o.bgColor}; width: ${o.width}; height: ${o.height};" draggable="true">${o.text}</div>`;document.querySelector(".left-sidebar__elements").innerHTML=t}else if(t.classList.contains("left-sidebar__categories-text")){let e=textElements,t="";for(let o of e)t+=`<div class="element"  tabindex="0" data-type="${o.type}" data-textstyle="${o.textStyle}" style="color: ${o.color}; width: ${o.width}; height: ${o.height}; font-size: ${o.fontSize}" draggable="true">${o.text}</div>`;document.querySelector(".left-sidebar__elements").innerHTML=t}else if(t.classList.contains("left-sidebar__categories-image")){let e=imageElements,t="";for(let o of e)t+=`<div class="element"  tabindex="0" data-type="${o.type}" style="width: ${o.width}; border: ${o.border}; background-image: ${o.bgImage}; height: ${o.height};" draggable="true"> </div>`;document.querySelector(".left-sidebar__elements").innerHTML=t}else if(t.classList.contains("left-sidebar__categories-icon")){let e=iconElements,t="";for(let o of e)t+=`<div class="element"  tabindex="0" data-type="${o.type}" style="width: ${o.width}; border: ${o.border}; icon: ${o.icon}; height: ${o.height};" draggable="true"> </div>`;document.querySelector(".left-sidebar__elements").innerHTML=t}dragAndDrop()};document.addEventListener("DOMContentLoaded",(function(e){let t=localStorage.getItem("login"),o=localStorage.getItem("firstname");null!=t&&(document.getElementById("wrapper__button").innerHTML=`<div>Привет, ${o}!</div><button id="buttonOut" onclick="outUser()" class="regButton">Выйти</button>`)}));let errors=[];function showReg(e){errors=[],document.getElementById("windowReg").style.display=e,document.getElementById("gray").style.display=e}function showIn(e){document.getElementById("windowIn").style.display=e,document.getElementById("gray2").style.display=e;let t=localStorage.getItem("email"),o=localStorage.getItem("pass");null!=t&&(document.querySelector("#email__in").value=t),null!=t&&(document.querySelector("#pass__in").value=o)}function checkValidity(e){let t=e.validity;return console.log(t.valueMissing),t.valueMissing&&errors.push("Поле "+e.placeholder+" не заполнено"),t.patternMismatch&&errors.push("Не верный формат заполнения e-mail"),errors}function checkPassword(){let e=document.querySelector("#pass1").value,t=document.querySelector("#pass2").value;return console.log(e),null!=e&&(e.length<4&&errors.push("Минимальное значение пароля не может быть меньше, чем 4"),e.length>10&&errors.push("Максимальное значение пароля не может быть больше, чем 10"),-1===e.search(/[a-z]/)&&errors.push("Пароль должен содержать минимум одну прописную букву"),-1===e.search(/[A-Z]/)&&errors.push("Пароль должен содержать минимум одну заглавную букву"),-1===e.search(/[0123456789]/)&&errors.push("Пароль должен содержать минимум одну цифру"),e!=t&&errors.push("Пароль не совпадает!")),errors}function pushReg(){let e=document.querySelectorAll(".inputReg");console.log(e);for(let t of e)checkValidity(t);checkPassword(),0==errors?saveData():(document.getElementById("error").innerHTML=errors.join(".<br>"),errors=[]),document.querySelector("form").addEventListener("submit",(e=>e.preventDefault()))}function saveData(){let e=document.querySelector("#firstname").value,t=document.querySelector("#lastname").value,o=document.querySelector("#email").value,l=document.querySelector("#pass1").value,n=document.querySelector("#pass2").value;console.log(l,n),document.querySelector(".error").innerHTML="",null==localStorage.getItem("firstName")&&localStorage.setItem("firstname",e),null==localStorage.getItem("lastname")&&localStorage.setItem("lastname",t),null==localStorage.getItem("email")&&localStorage.setItem("email",o),null==localStorage.getItem("pass")&&localStorage.setItem("pass",n),localStorage.setItem("login",!0),document.getElementById("windowReg").style.display="none",document.getElementById("gray").style.display="none",document.querySelector("form").addEventListener("submit",(e=>e.preventDefault())),document.getElementById("wrapper__button").innerHTML=`<div>Привет, ${e}!</div><button id="buttonOut" onclick="outUser()" class="regButton">Выйти</button>`}function getIn(){document.querySelector("#inForm").addEventListener("submit",(e=>e.preventDefault())),document.getElementById("windowIn").style.display="none",document.getElementById("gray2").style.display="none",document.getElementById("wrapper__button").innerHTML=`<div>Привет, ${localStorage.getItem("firstname")}!</div><button id="buttonOut" onclick="outUser()" class="regButton">Выйти</button>`,localStorage.setItem("login",!0)}function outUser(){document.getElementById("wrapper__button").innerHTML='<button id="buttonReg" onclick="showReg(\'block\')" class="regButton">Регистрация</button>\n    <button id="buttonIn" onclick="showIn(\'block\')" class="regButton">Войти</button>',localStorage.removeItem("login")}let templateIndCount=0;const menuBlock=document.querySelector(".left-sidebar__elements"),templateBlock=document.querySelector(".template");templateBlock.addEventListener("dragover",dragOver),templateBlock.addEventListener("dragenter",dragEnter),templateBlock.addEventListener("dragenter",dragLeave),templateBlock.addEventListener("drop",dragDrop,{capture:!0});const keyCodes={delete:46,arrowLeft:37,arrowUp:38,arrowRight:39,arrowDown:40,cKey:67,vKey:86};class DragNDrop{}class Element{constructor(e,t){this.type=e,this.classes=t}duplicate(){}showMenu(){}delete(){}saveToLS(){let e=[],t=null;localStorage.getItem("template")?(t=JSON.parse(localStorage.getItem("template")),t.length>1?e.push(...t,this):e.push(t,this),localStorage.setItem("template",JSON.stringify(e))):localStorage.setItem("template",JSON.stringify(this))}}class ResizableElement extends Element{constructor(e,t,o,l,n,r){super(e,t),this.width=o,this.height=l,this.posX=n,this.posY=r}changeHeight(){}changeWidth(){}changePosX(){}changePosY(){}}class Block extends Element{constructor(e,t,o){super(e,t),this.bgColor=o,this.templateInd=templateIndCount++}setTemplateInd(){}setBackgroundColor(){}}class Button extends ResizableElement{constructor(e,t,o,l,n,r,s,a,i){super(e,t,o,l,n,r),this.bgColor=s,this.btnLabel=a,this.fontColor=i}setBackgroundColor(){}setBtnLabel(){}setFontColor(){}}class Image extends ResizableElement{constructor(e,t,o,l,n,r,s,a,i,c){super(e,t,o,l,n,r,s,a),this.bgImage=i,this.border=c}setBackgroundImage(){}setBorder(){}}class SocialIcon extends ResizableElement{constructor(e,t,o,l,n,r,s,a){super(e,t,o,l,n,r),this.iconColor=s,this.link=a}setIconColor(){}setLink(){}}class Text extends Element{constructor(e,t,o,l){super(e,t),this.color=o,this.textStyle=l}setColor(){}changeText(){}}function dragAndDrop(){console.log("start dragndrop");document.querySelectorAll(".element").forEach((e=>{e.addEventListener("dragstart",dragStart),e.addEventListener("dragend",dragEnd)}))}let templateFlag=!1,movingElement=null,elementX=0,elementY=0;function dragStart(e){getPosition(e),getTemplateFlag(e),console.log("drag start"),console.log(this),setTimeout((()=>{e.target.parentNode.isSameNode(menuBlock)?movingElement=e.target.cloneNode(!0):e.target.parentNode.isSameNode(templateBlock)&&(movingElement=e.target),console.log(movingElement)}))}function dragEnd(e){console.log("drag end"),e.preventDefault()}function dragOver(e){e.preventDefault(),console.log("drag over")}function dragEnter(e){e.preventDefault(),console.log("drag enter")}function dragLeave(e){e.preventDefault(),console.log("drag leave")}function createNewElement(e,t){const o=t.dataset.type;console.log(o);let l=null;if("block"===o)t.classList.add("wide"),l=new Block(o,t.classList,t.style.backgroundColor),l.saveToLS();else switch(t.classList.add("draggable-element"),setPosition(e),o){case"button":t.classList.add("template__button"),l=new Button(o,t.classList,t.clientWidth,t.clientHeight,t.style.left,t.style.top,t.style.backgroundColor,t.innerHTML,t.style.color),l.saveToLS();break;case"icon":break;case"text":t.style.width="";const e=t.dataset.textstyle;t.classList.add(e),t.classList.add("text"),l=new Text(o,t.classList,t.style.color,t.dataset.textstyle),l.saveToLS()}}function dragDrop(e){e.stopPropagation(),e.preventDefault(),console.log("drag drop"),e.target.isSameNode(movingElement)||(this.append(movingElement),movingElement.classList.remove("element"),movingElement.classList.add("template__element"),addListenersForNewElement(movingElement),templateFlag?setPosition(e):createNewElement(e,movingElement))}function pasteCopiedElement(e){templateBlock.append(e),e.style.top=e.style.top.slice(0,-2)- -50+"px",e.style.left=e.style.left.slice(0,-2)- -50+"px",e.classList.remove("selected"),addListenersForNewElement(e)}function addListenersForNewElement(e){e.addEventListener("click",handleClick),e.addEventListener("dblclick",handleDoubleClick),e.addEventListener("focusout",handleFocusOut),e.addEventListener("dragstart",dragStart)}function setPosition(e){offParTop=e.target.offsetParent.offsetTop,offParLeft=e.target.offsetParent.offsetLeft,movingElement.style.top=e.clientY-elementY-offParTop+"px",movingElement.style.left=e.clientX-elementX-offParLeft+"px"}function getPosition(e){elementY=e.offsetY,elementX=e.offsetX}function handleClick(e){e.target.classList.add("selected"),e.target.focus(),console.log("focus"),e.target.addEventListener("keydown",handleKeyDown)}function handleDoubleClick(e){console.log("dblclick"),e.target.contentEditable=!0,e.target.removeEventListener("click",handleClick),e.target.removeEventListener("keydown",handleKeyDown),e.target.classList.add("selected"),"text"===e.target.dataset.type&&(e.target.style.height="auto")}function handleFocusOut(e){console.log("focusout"),window.getSelection().removeAllRanges(),e.target.contentEditable=!1,e.target.classList.remove("selected"),e.target.addEventListener("click",handleClick)}function handleKeyDown(e){if(e.preventDefault(),!0===e.ctrlKey&&"c"===e.key)movingElement=e.target.cloneNode(!0);else if(!0===e.ctrlKey&&"v"===e.key)pasteCopiedElement(movingElement);else if("Delete"===e.key)e.target.remove();else if("ArrowLeft"===e.key){let t=e.target.style.left;e.target.style.left=t.slice(0,t.length-2)-1+"px"}else if("ArrowRight"===e.key){let t=e.target.style.left;e.target.style.left=t.slice(0,t.length-2)- -1+"px"}else if("ArrowUp"===e.key){let t=e.target.style.top;e.target.style.top=t.slice(0,t.length-2)-1+"px"}else if("ArrowDown"===e.key){let t=e.target.style.top;e.target.style.top=t.slice(0,t.length-2)- -1+"px"}}function getTemplateFlag(e){console.log("templateFlag"),console.log(e.target.parentNode),templateFlag=!!e.target.parentNode.isSameNode(templateBlock)}